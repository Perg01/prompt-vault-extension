document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("save-form"),t=document.getElementById("title-input"),n=document.getElementById("content-preview"),o=document.getElementById("tags-input"),a=document.getElementById("save-button"),l=document.getElementById("status-message"),s=document.getElementById("folder-select");let d="";chrome.storage.local.get(["tempChatData"],e=>{if(e.tempChatData){const{title:o,content:a}=e.tempChatData;t.value=o,n.textContent=a,d=a,chrome.storage.local.remove("tempChatData")}}),chrome.runtime.sendMessage({type:"GET_FOLDERS"},e=>{var t;e&&e.success?(console.log("Folders received:",e.data),(t=e.data)&&0!==t.length&&t.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,s.appendChild(t)})):console.error("Failed to fetch folders:",e?.error||"Unknown error")}),e.addEventListener("submit",e=>{e.preventDefault(),a.disabled=!0,a.textContent="Saving...",l.textContent="";const n=o.value.split(",").map(e=>e.trim()).filter(e=>e),c="unfiled"===s.value?null:s.value;chrome.runtime.sendMessage({type:"SAVE_FINAL_CHAT",payload:{title:t.value,content:d,tags:n,folderId:c}},e=>{e.success?(l.textContent="Chat saved successfully!",a.style.color="green",setTimeout(()=>{window.close()})):(l.textContent=e.message||"Failed to save.",a.style.color="red",a.disabled=!1,a.textContent="Save to Vault")})})});