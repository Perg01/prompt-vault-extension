function scrapeConversation(){console.log("PromptVault: Scraping conversation...");let t="",e="Untitled Chat";const n=document.querySelectorAll('article[data-testid^="conversation-turn-"]');if(0===n.length)return console.log("Scraping failed: Could not find any conversation text. The ChatGPT UI may have changed."),void alert("Scraping Failed: Could not find any conversation text to scrape. The ChatGPT UI may have changed.");n.forEach((n,o)=>{const r=n.querySelector("div[data-message-author-role]");if(!r)return;const a="user"===r.getAttribute("data-message-author-role")?"User":"ChatGPT";let s=n.querySelector(".markdown.prose");s||(s=n.querySelector(".whitespace-pre-wrap"));const i=s?s.textContent.trim():"";"User"===a&&0===o&&i&&(e=i.substring(0,50)+"..."),i&&(t+=`${a}:\n${i}\n\n`)}),t?(console.log("--- SCRAPED CONTENT ---"),console.log(t),chrome.runtime.sendMessage({type:"OPEN_POPUP_EDITOR",payload:{title:e,content:t.trim()}}),alert("Conversation data sent to background for processing!")):(console.log("Could not find any conversation text."),alert("Could not scrape any text, though message containers were found."))}function injectStyles(){const t="promptvault-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.textContent="\n    #promptvault-save-btn {\n      /* Base styles from before */\n      display: flex;\n      align-items: center;\n      position: absolute;\n      left: 50%;\n      transform: translateX(-50%);\n      bottom: 1.5rem; /* Increased bottom margin slightly */\n      background-color: #333;\n      color: white;\n      border: 1px solid #555;\n      padding: 8px 16px;\n      border-radius: 8px;\n      cursor: pointer;\n      z-index: 2147483647; /* Use a very high z-index to stay on top */\n      box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n      transition: all 0.2s ease-in-out; /* Add transition for smooth hover */\n    }\n\n    /* This is our new hover effect */\n    #promptvault-save-btn:hover {\n      filter: brightness(1.15);\n      transform: translateX(-50%) translateY(-2px); /* Lift effect */\n      box-shadow: 0 4px 8px rgba(0,0,0,0.3);\n    }\n  ",document.head.appendChild(e)}function addSaveButton(){const t=document.querySelector('div[id="prompt-textarea"]');if(!t)return;const e=t.closest("form");if(!e)return;const n=e.parentElement;if(n&&!document.getElementById("promptvault-save-btn")){console.log("PromptVault: Target area found. Adding save button."),injectStyles(),"static"===getComputedStyle(n).position&&(n.style.position="relative");const t=document.createElement("button");t.id="promptvault-save-btn",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">\n        <path stroke-linecap="round" stroke-linejoin="round" d="M9 3.75H6.912a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859M12 3v8.25m0 0-3-3m3 3 3-3" />\n        </svg> Save to PromptVault',t.addEventListener("click",scrapeConversation),n.appendChild(t)}}setInterval(addSaveButton,1e3);